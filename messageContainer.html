<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Chat Site</title>
    <link rel="stylesheet" href="css/messages.css">
</head>
<body id="messageContainerBody">

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const messages = JSON.parse(localStorage.getItem('messages')) || [];
            const messageContainerBody = document.getElementById('messageContainerBody');

            messages.forEach((messageText, index) => {
                const newDiv = createMessageElement(messageText);

                // Add contextmenu event listener to delete the message
                newDiv.addEventListener('contextmenu', event => {
                    event.preventDefault(); // Prevent the default context menu from appearing
                    if (confirm('Are you sure you want to delete this message?')) {
                        // Remove the message from localStorage
                        const updatedMessages = messages.filter((_, i) => i !== index);
                        localStorage.setItem('messages', JSON.stringify(updatedMessages));

                        // Remove the message from the DOM
                        newDiv.remove();

                        // Refresh the page
                        window.location.reload();

                        // Focus on the message input field in chat.html
                        const iframeParent = window.parent.document;
                        const messageInput = iframeParent.getElementById('messageInput');
                        if (messageInput) {
                            messageInput.focus();
                        }
                    }
                });

                // Append the new message to the container
                messageContainerBody.appendChild(newDiv);
            });

            // Scroll to the bottom of the container after all messages are loaded
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });

            // Prevent the default context menu from appearing on right-click
            document.addEventListener('contextmenu', event => {
                event.preventDefault(); // Prevent the default context menu from appearing
            });
        });

        // Helper function to create a message element
        function createMessageElement(messageText) {
            const newDiv = document.createElement('div');
            newDiv.classList.add('message');

            const newImg = document.createElement('img');
            newImg.classList.add('profileImg');
            newImg.src = 'images/chatDisplayRef.jpg';
            newImg.draggable = false;
            newImg.alt = 'profile';
            newDiv.appendChild(newImg);

            const newP = document.createElement('p');
            newP.textContent = messageText;
            newP.classList.add('message-text');
            newDiv.appendChild(newP);

            return newDiv;
        }
    </script>
    
</body>
</html>